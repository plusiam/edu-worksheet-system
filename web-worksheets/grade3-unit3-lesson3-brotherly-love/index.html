<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3í•™ë…„ 3ë‹¨ì› 3ì°¨ì‹œ - ìš°ì• ë¥¼ ì§€ì¼œìš”</title>
    <link rel="stylesheet" href="../common/styles.css">
    <style>
        .lesson-header {
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 50%, #fecfef 100%);
            color: #2d3748;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            margin-bottom: 30px;
            border: 3px solid #f687b3;
        }
        
        .lesson-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin: 15px 0;
            font-size: 0.95em;
        }
        
        .activity-card {
            background: linear-gradient(135deg, #fff5f5 0%, #fed7e2 100%);
            border: 3px solid #f687b3;
            border-radius: 20px;
            padding: 30px;
            margin: 25px 0;
            text-align: center;
            min-height: 300px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }
        
        .activity-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            transform: rotate(45deg);
            animation: shimmer 3s infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%) rotate(45deg); }
            100% { transform: translateX(100%) rotate(45deg); }
        }
        
        .family-icon {
            font-size: 4em;
            margin-bottom: 15px;
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }
        
        .situation-text {
            font-size: 1.3em;
            line-height: 1.7;
            margin-bottom: 25px;
            color: #2d3748;
            font-weight: 500;
        }
        
        .choice-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 30px;
        }
        
        .choice-btn {
            padding: 20px;
            border: 3px solid #e2e8f0;
            border-radius: 15px;
            background: white;
            cursor: pointer;
            font-size: 1.1em;
            transition: all 0.3s ease;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            position: relative;
        }
        
        .choice-btn:hover {
            border-color: #f687b3;
            background: #fef5e7;
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        .choice-btn.correct {
            background: linear-gradient(135deg, #c6f6d5 0%, #9ae6b4 100%);
            border-color: #48bb78;
            color: #2f855a;
            animation: correctPulse 0.6s ease-in-out;
        }
        
        .choice-btn.wrong {
            background: linear-gradient(135deg, #fed7d7 0%, #feb2b2 100%);
            border-color: #f56565;
            color: #c53030;
            animation: wrongShake 0.6s ease-in-out;
        }
        
        @keyframes correctPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        @keyframes wrongShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        .step-indicator {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 30px 0;
            padding: 20px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        
        .step {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #718096;
            margin: 0 10px;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .step.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: scale(1.2);
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.4);
        }
        
        .step.completed {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
        }
        
        .step::after {
            content: '';
            position: absolute;
            width: 30px;
            height: 3px;
            background: #e2e8f0;
            right: -25px;
            top: 50%;
            transform: translateY(-50%);
        }
        
        .step:last-child::after {
            display: none;
        }
        
        .step.completed::after {
            background: #48bb78;
        }
        
        .reflection-section {
            background: linear-gradient(135deg, #e6fffa 0%, #b2f5ea 100%);
            border: 3px solid #4fd1c7;
            border-radius: 20px;
            padding: 30px;
            margin: 30px 0;
            text-align: center;
        }
        
        .practice-input {
            width: 100%;
            min-height: 120px;
            padding: 20px;
            border: 3px solid #e2e8f0;
            border-radius: 15px;
            font-size: 1.1em;
            resize: vertical;
            margin: 15px 0;
            font-family: 'Malgun Gothic', sans-serif;
            transition: all 0.3s ease;
        }
        
        .practice-input:focus {
            border-color: #f687b3;
            outline: none;
            box-shadow: 0 0 15px rgba(246, 135, 179, 0.2);
        }
        
        .learning-objectives {
            background: linear-gradient(135deg, #ebf8ff 0%, #bee3f8 100%);
            border: 3px solid #63b3ed;
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
        }
        
        .next-btn {
            margin-top: 25px;
            display: none;
            background: linear-gradient(135deg, #f687b3 0%, #f093fb 100%);
            transform: scale(1.05);
        }
        
        .next-btn:hover {
            transform: scale(1.08);
            box-shadow: 0 8px 25px rgba(246, 135, 179, 0.3);
        }
        
        .progress-section {
            background: linear-gradient(135deg, #fff 0%, #f7fafc 100%);
            border: 2px solid #e2e8f0;
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }
        
        .character-dialogue {
            background: white;
            border: 3px solid #fbb6ce;
            border-radius: 20px;
            padding: 20px;
            margin: 20px 0;
            position: relative;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .character-dialogue::before {
            content: '';
            position: absolute;
            bottom: -15px;
            left: 30px;
            width: 0;
            height: 0;
            border-left: 15px solid transparent;
            border-right: 15px solid transparent;
            border-top: 15px solid #fbb6ce;
        }
        
        .analysis-section {
            background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
            border: 3px solid #f59e0b;
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="lesson-header">
            <h1>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ 3í•™ë…„ 3ë‹¨ì› 3ì°¨ì‹œ</h1>
            <h2>ìš°ì• ë¥¼ ì§€ì¼œìš”</h2>
            <div class="lesson-info">
                <div>ğŸ“š ë‹¨ì›: í•¨ê»˜í•˜ëŠ” ìš°ë¦¬ ê°€ì¡±</div>
                <div>ğŸ‘¥ ëŒ€ìƒ: ì´ˆë“±í•™êµ 3í•™ë…„</div>
                <div>â° ì°¨ì‹œ: 3ë‹¨ì› 3ì°¨ì‹œ</div>
                <div>ğŸ¯ ì£¼ì œ: í˜•ì œìë§¤ ì‚¬ì´ì˜ ìš°ì• </div>
            </div>
        </div>
        
        <div class="learning-objectives">
            <h3>ğŸ¯ í•™ìŠµ ëª©í‘œ</h3>
            <ul style="text-align: left; margin: 10px 0;">
                <li>í˜•ì œìë§¤ ì‚¬ì´ì—ì„œ ìš°ì• ë¥¼ ì‹¤ì²œí•˜ëŠ” íƒœë„ë¥¼ ìµíŒë‹¤.</li>
                <li>ê°ˆë“±ì´ ìƒê¸¸ ìˆ˜ ìˆëŠ” ìƒí™©ì„ ì´í•´í•˜ê³  í•´ê²°í•˜ëŠ” ë°©ë²•ì„ ì°¾ì•„ë³¸ë‹¤.</li>
                <li>ê°€ì¡±ê³¼ ì‚¬ì´ì¢‹ê²Œ ì§€ë‚´ê¸° ìœ„í•œ ìì‹ ì˜ ì‹¤ì²œ ê³„íšì„ ì„¸ìš´ë‹¤.</li>
            </ul>
            <div style="background: #2b6cb0; color: white; padding: 15px; border-radius: 10px; margin-top: 15px;">
                <strong>ğŸ¤” í•™ìŠµ ë¬¸ì œ</strong><br>
                ìš°ë¦¬ëŠ” í˜•ì œìë§¤ì™€ ì–´ë–»ê²Œ ì‚¬ì´ì¢‹ê²Œ ì§€ë‚¼ ìˆ˜ ìˆì„ê¹Œìš”?
            </div>
        </div>
        
        <div class="step-indicator">
            <div class="step active" id="step1">ë„ì…</div>
            <div class="step" id="step2">ë¶„ì„</div>
            <div class="step" id="step3">í•´ê²°</div>
            <div class="step" id="step4">ì‹¤ì²œ</div>
            <div class="step" id="step5">ì •ë¦¬</div>
        </div>
        
        <div class="progress-section">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <span style="font-weight: bold; font-size: 1.1em;">ğŸ“ˆ í•™ìŠµ ì§„í–‰ë„</span>
                <span class="progress-text"><span id="currentStep">1</span> / 5 ë‹¨ê³„</span>
            </div>
            <div class="progress-bar" style="margin: 15px 0;">
                <div class="progress-fill" id="progressBar" style="width: 20%;"></div>
            </div>
        </div>
        
        <div id="activityContainer">
            <!-- í™œë™ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
        </div>
        
        <div class="text-center">
            <button class="btn btn-primary next-btn" id="nextBtn" onclick="nextActivity()">
                ë‹¤ìŒ ë‹¨ê³„ë¡œ â¡ï¸
            </button>
            <button class="btn btn-success next-btn" id="finishBtn" onclick="finishLesson()" style="display: none;">
                í•™ìŠµ ì™„ë£Œ ğŸ‰
            </button>
        </div>
    </div>

    <!-- ì™„ë£Œ ëª¨ë‹¬ -->
    <div class="modal" id="resultModal">
        <div class="modal-content" style="max-width: 600px;">
            <h2>ğŸ‰ ìš°ì•  í•™ìŠµ ì™„ë£Œ!</h2>
            <div id="resultContent"></div>
            <button class="btn btn-primary" onclick="location.href='../index.html'">
                ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°
            </button>
        </div>
    </div>

    <script src="../common/scripts.js"></script>
    <script>
        // í•™ìŠµ í™œë™ ë°ì´í„° (êµìˆ˜í•™ìŠµì§€ë„ì•ˆì— ë§ì¶¤)
        const activities = [
            {
                id: 'introduction',
                type: 'story',
                title: 'ë„ì…: í˜•ì œìë§¤ ê°ˆë“± ìƒí™© ì´ì•¼ê¸°',
                character: 'ğŸ‘¦ğŸ‘§',
                story: `
                    <div class="character-dialogue">
                        <strong>ğŸ  ê¹€ê°€ë„¤ ì´ì•¼ê¸°</strong><br><br>
                        ì´ˆë“±í•™êµ 3í•™ë…„ ë¯¼ìˆ˜ì™€ 2í•™ë…„ ì§€ìˆ˜ëŠ” í•œ ë°©ì„ ì“°ëŠ” ë‚¨ë§¤ì…ë‹ˆë‹¤. 
                        ì˜¤ëŠ˜ ë¯¼ìˆ˜ê°€ í•™êµì—ì„œ ëŒì•„ì™€ë³´ë‹ˆ ìì‹ ì˜ ë ˆê³  ë¸”ë¡ìœ¼ë¡œ ì§€ìˆ˜ê°€ ë†€ê³  ìˆì—ˆì–´ìš”.
                        <br><br>
                        <strong>ë¯¼ìˆ˜:</strong> "ì•¼! ë‚´ ë ˆê³  ì™œ í—ˆë½ë„ ì—†ì´ ë§Œì ¸?" ğŸ˜ <br>
                        <strong>ì§€ìˆ˜:</strong> "í˜•ì´ ì•ˆ ì“°ê³  ìˆì—ˆì–ì•„! ë‚˜ë„ ë†€ê³  ì‹¶ì–´!" ğŸ˜¢<br>
                        <strong>ë¯¼ìˆ˜:</strong> "ë‚´ ê±°ë‹ˆê¹Œ ë‚´ê°€ ëŒì•„ì˜¤ë©´ ë°”ë¡œ ì¹˜ì›Œì•¼ì§€!" ğŸ˜¤<br>
                        <strong>ì§€ìˆ˜:</strong> "í˜•ì€ ë§¨ë‚  í˜¼ìë§Œ ë†€ë ¤ê³  í•´!" ğŸ˜­
                    </div>
                `,
                question: 'ì´ëŸ° ìƒí™©ì„ ë³´ë©´ì„œ ì—¬ëŸ¬ë¶„ì˜ ê¸°ë¶„ì€ ì–´ë–¨ê¹Œìš”?',
                choices: [
                    { text: 'ë¯¼ìˆ˜ì˜ ê¸°ë¶„ì´ ì´í•´ê°€ ë¼ìš”. ë‚´ ë¬¼ê±´ì„ í—ˆë½ ì—†ì´ ì“°ë©´ í™”ë‚  ê²ƒ ê°™ì•„ìš”.', correct: true },
                    { text: 'ì§€ìˆ˜ì˜ ê¸°ë¶„ì´ ì´í•´ê°€ ë¼ìš”. í˜•ì œë¼ë¦¬ëŠ” ë‚˜ëˆ  ì¨ì•¼ í•œë‹¤ê³  ìƒê°í•´ìš”.', correct: true },
                    { text: 'ë‘˜ ë‹¤ ì˜ëª»ëœ ê²ƒ ê°™ì•„ìš”. ì„œë¡œ ì´ì•¼ê¸°ë¥¼ í–ˆìœ¼ë©´ ì¢‹ê² ì–´ìš”.', correct: true },
                    { text: 'ìš°ë¦¬ ì§‘ì—ì„œë„ ì´ëŸ° ì¼ì´ ìì£¼ ìˆì–´ì„œ ë§ˆìŒì´ ì•„íŒŒìš”.', correct: true }
                ],
                explanation: 'ì—¬ëŸ¬ë¶„ ëª¨ë‘ ë§ìŠµë‹ˆë‹¤! ê°ìì˜ ì…ì¥ì„ ì´í•´í•˜ëŠ” ê²ƒì´ ìš°ì• ì˜ ì‹œì‘ì´ì—ìš”. ì´ì œ ì´ëŸ° ìƒí™©ì„ ì–´ë–»ê²Œ í•´ê²°í•  ìˆ˜ ìˆëŠ”ì§€ í•¨ê»˜ ì•Œì•„ë³¼ê¹Œìš”?'
            },
            {
                id: 'analysis1',
                type: 'analysis',
                title: 'í™œë™ 1: ê°ˆë“± ìƒí™© ë¶„ì„í•˜ê¸°',
                character: 'ğŸ”',
                situation: 'ë¯¼ìˆ˜ì™€ ì§€ìˆ˜ì˜ ê°ˆë“± ìƒí™©ì„ ë‹¤ì‹œ í•œë²ˆ ì‚´í´ë³´ì„¸ìš”. ì™œ ì´ëŸ° ê°ˆë“±ì´ ìƒê²¼ì„ê¹Œìš”?',
                question: 'ê°ˆë“±ì´ ìƒê¸´ ê°€ì¥ í° ì´ìœ ëŠ” ë¬´ì—‡ì¼ê¹Œìš”?',
                choices: [
                    { text: 'ì„œë¡œ ë¯¸ë¦¬ ì´ì•¼ê¸°í•˜ì§€ ì•Šê³  ìê¸° ìƒê°ë§Œ í–ˆê¸° ë•Œë¬¸', correct: true },
                    { text: 'ë¯¼ìˆ˜ê°€ ë„ˆë¬´ ì´ê¸°ì ì´ì–´ì„œ', correct: false },
                    { text: 'ì§€ìˆ˜ê°€ í—ˆë½ì„ ë°›ì§€ ì•Šê³  ì¨ì„œ', correct: false },
                    { text: 'ë¶€ëª¨ë‹˜ì´ ê·œì¹™ì„ ì •í•´ì£¼ì§€ ì•Šì•„ì„œ', correct: false }
                ],
                explanation: 'ë§ì•„ìš”! ì„œë¡œ ëŒ€í™”í•˜ê³  ë°°ë ¤í•˜ì§€ ì•Šì•„ì„œ ìƒê¸´ ë¬¸ì œì˜ˆìš”. ë¯¼ìˆ˜ë„ ì§€ìˆ˜ë„ ê°ì ì´ìœ ê°€ ìˆì§€ë§Œ, ë¯¸ë¦¬ ì´ì•¼ê¸°í–ˆë‹¤ë©´ ê°ˆë“±ì„ í”¼í•  ìˆ˜ ìˆì—ˆì„ ê±°ì˜ˆìš”.'
            },
            {
                id: 'analysis2',
                type: 'situation',
                title: 'í™œë™ 1: ë‹¤ë¥¸ ê°ˆë“± ìƒí™© ë¶„ì„í•˜ê¸°',
                character: 'ğŸ“º',
                situation: 'ì €ë… ì‹œê°„, í˜• ì¤€í˜¸(5í•™ë…„)ì™€ ë™ìƒ ì„œì—°ì´(3í•™ë…„)ê°€ TV ì±„ë„ì„ ë‘ê³  ë‹¤íˆ¬ê³  ìˆìŠµë‹ˆë‹¤. ì¤€í˜¸ëŠ” ì¶•êµ¬ë¥¼ ë³´ê³  ì‹¶ì–´í•˜ê³ , ì„œì—°ì´ëŠ” ë§Œí™”ë¥¼ ë³´ê³  ì‹¶ì–´í•´ìš”.',
                question: 'ì´ëŸ° ìƒí™©ì—ì„œ ìš°ì• ë¡œìš´ í•´ê²° ë°©ë²•ì€ ë¬´ì—‡ì¼ê¹Œìš”?',
                choices: [
                    { text: 'í˜•ì´ ë™ìƒì—ê²Œ ì–‘ë³´í•´ì•¼ í•œë‹¤', correct: false },
                    { text: 'ì„œë¡œ ì‹œê°„ì„ ë‚˜ëˆ„ì–´ì„œ ë³´ê¸°ë¡œ ì•½ì†í•œë‹¤', correct: true },
                    { text: 'ë¶€ëª¨ë‹˜ê»˜ íŒë‹¨ì„ ë§¡ê¸´ë‹¤', correct: false },
                    { text: 'ë” í° ì†Œë¦¬ë¡œ ìš°ê¸°ëŠ” ì‚¬ëŒì´ ì´ê¸´ë‹¤', correct: false }
                ],
                explanation: 'í›Œë¥­í•´ìš”! ì„œë¡œ ì–‘ë³´í•˜ê³  íƒ€í˜‘í•˜ëŠ” ê²ƒì´ ì§„ì •í•œ ìš°ì• ì…ë‹ˆë‹¤. ì‹œê°„ì„ ë‚˜ëˆ„ì–´ ì‚¬ìš©í•˜ë©´ ë‘˜ ë‹¤ ë§Œì¡±í•  ìˆ˜ ìˆì–´ìš”.'
            },
            {
                id: 'solution1',
                type: 'roleplay',
                title: 'í™œë™ 2: ì—­í• ë†€ì´ - ê°ˆë“±ì„ ìš°ì• ë¡œ í•´ê²°í•˜ê¸°',
                character: 'ğŸ­',
                situation: `
                    <div class="analysis-section">
                        <h4>ğŸ¬ ì—­í• ë†€ì´ ìƒí™©</h4>
                        <p><strong>ìƒí™©:</strong> ì–¸ë‹ˆ ì†Œí¬(4í•™ë…„)ì™€ ë™ìƒ ë¯¼ì§€(2í•™ë…„)ê°€ ìƒˆë¡œ ì‚° ìƒ‰ì—°í•„ì„ ë‘ê³  ë‹¤íˆ¬ê³  ìˆì–´ìš”.</p>
                        <p><strong>ì–¸ë‹ˆ ì†Œí¬:</strong> "ì´ê±´ ë‚´ê°€ ë°›ì€ ì„ ë¬¼ì´ì•¼!"</p>
                        <p><strong>ë™ìƒ ë¯¼ì§€:</strong> "ë‚˜ë„ ì˜ˆìœ ìƒ‰ì—°í•„ë¡œ ê·¸ë¦¼ ê·¸ë¦¬ê³  ì‹¶ì–´!"</p>
                    </div>
                `,
                question: 'ì†Œí¬ëŠ” ì–´ë–»ê²Œ ë§í•˜ë©´ ìš°ì• ë¡œìš´ í•´ê²°ì´ ë ê¹Œìš”?',
                choices: [
                    { text: '"ë‚´ ê±°ë‹ˆê¹Œ ì•ˆ ë¼!" ë¼ê³  ë‹¨í˜¸í•˜ê²Œ ë§í•œë‹¤', correct: false },
                    { text: '"ë¯¼ì§€ì•¼, í•¨ê»˜ ì“°ì! ë„¤ê°€ ì“¸ ë•ŒëŠ” ë¯¸ë¦¬ ë§í•´ì¤˜" ë¼ê³  ë§í•œë‹¤', correct: true },
                    { text: '"ì—„ë§ˆí•œí…Œ ìƒˆë¡œ ì‚¬ë‹¬ë¼ê³  í•´" ë¼ê³  ë§í•œë‹¤', correct: false },
                    { text: 'ì•„ë¬´ ë§ë„ í•˜ì§€ ì•Šê³  ìˆ¨ê¸´ë‹¤', correct: false }
                ],
                explanation: 'ì •ë§ ì¢‹ì•„ìš”! í•¨ê»˜ ë‚˜ëˆ„ì–´ ì“°ìê³  ì œì•ˆí•˜ë©´ì„œë„ ì„œë¡œ ë°°ë ¤í•˜ëŠ” ë°©ë²•ì„ ì œì‹œí–ˆë„¤ìš”. ì´ê²ƒì´ ë°”ë¡œ ìš°ì• ì…ë‹ˆë‹¤!'
            },
            {
                id: 'practice',
                type: 'reflection',
                title: 'í™œë™ 3: ë‚˜ì˜ ìš°ì•  ì‹¤ì²œ ë°©ë²• ì°¾ê¸°',
                character: 'ğŸ’–',
                question: 'ì—¬ëŸ¬ë¶„ì€ í˜•ì œìë§¤ì™€ ì‚¬ì´ì¢‹ê²Œ ì§€ë‚´ê¸° ìœ„í•´ ì–´ë–¤ ì¼ì„ ì‹¤ì²œí•˜ê³  ì‹¶ë‚˜ìš”?',
                prompt: 'ë‚˜ëŠ” í˜•ì œìë§¤ì™€ ìš°ì• ë¡­ê²Œ ì§€ë‚´ê¸° ìœ„í•´...',
                examples: [
                    'ì„œë¡œì˜ ë¬¼ê±´ì„ ì“¸ ë•ŒëŠ” ë¯¸ë¦¬ í—ˆë½ì„ êµ¬í•˜ê² ìŠµë‹ˆë‹¤.',
                    'ë™ìƒ(í˜•/ì–¸ë‹ˆ)ì˜ ë§ˆìŒì„ ë¨¼ì € ìƒê°í•´ë³´ê² ìŠµë‹ˆë‹¤.',
                    'ê°ˆë“±ì´ ìƒê¸°ë©´ ì†Œë¦¬ì§€ë¥´ì§€ ì•Šê³  ì°¨ê·¼ì°¨ê·¼ ì´ì•¼ê¸°í•˜ê² ìŠµë‹ˆë‹¤.',
                    'ë‚´ê°€ ë¨¼ì € ì–‘ë³´í•˜ê³  ë°°ë ¤í•˜ê² ìŠµë‹ˆë‹¤.',
                    'ê°€ì¡±ì˜ ë¬¼ê±´ì€ í•¨ê»˜ ë‚˜ëˆ„ì–´ ì‚¬ìš©í•˜ê² ìŠµë‹ˆë‹¤.',
                    'ë™ìƒ(í˜•/ì–¸ë‹ˆ)ì´ í˜ë“¤ì–´í•  ë•Œ ë„ì™€ì£¼ê² ìŠµë‹ˆë‹¤.'
                ]
            }
        ];

        let currentActivityIndex = 0;
        let session = null;
        let userPractices = [];
        const stepNames = ['ë„ì…', 'ë¶„ì„', 'í•´ê²°', 'ì‹¤ì²œ', 'ì •ë¦¬'];

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            session = new LearningSession('grade3-unit3-lesson3-brotherly-love');
            showActivity(currentActivityIndex);
        });

        function showActivity(index) {
            const activity = activities[index];
            const container = document.getElementById('activityContainer');
            
            // ë‹¨ê³„ í‘œì‹œ ì—…ë°ì´íŠ¸
            updateStepIndicator(index);
            
            if (activity.type === 'story') {
                container.innerHTML = `
                    <div class="activity-card">
                        <div class="family-icon">${activity.character}</div>
                        <h3>${activity.title}</h3>
                        <div class="situation-text">${activity.story}</div>
                        <h4 style="color: #667eea; margin: 20px 0;">${activity.question}</h4>
                        <div class="choice-grid">
                            ${activity.choices.map((choice, i) => 
                                `<div class="choice-btn" onclick="selectChoice(${i}, ${choice.correct}, '${activity.explanation}')">${choice.text}</div>`
                            ).join('')}
                        </div>
                    </div>
                `;
            } else if (activity.type === 'analysis' || activity.type === 'situation' || activity.type === 'roleplay') {
                container.innerHTML = `
                    <div class="activity-card">
                        <div class="family-icon">${activity.character}</div>
                        <h3>${activity.title}</h3>
                        <div class="situation-text">${activity.situation}</div>
                        <h4 style="color: #667eea; margin: 20px 0;">${activity.question}</h4>
                        <div class="choice-grid">
                            ${activity.choices.map((choice, i) => 
                                `<div class="choice-btn" onclick="selectChoice(${i}, ${choice.correct}, '${activity.explanation}')">${choice.text}</div>`
                            ).join('')}
                        </div>
                    </div>
                `;
            } else if (activity.type === 'reflection') {
                container.innerHTML = `
                    <div class="reflection-section">
                        <div class="family-icon">${activity.character}</div>
                        <h3>${activity.title}</h3>
                        <div class="situation-text">${activity.question}</div>
                        <div style="text-align: left; margin: 25px 0;">
                            <h4 style="margin-bottom: 15px; color: #2b6cb0;">ğŸ’¡ ì‹¤ì²œ ë°©ë²• ì˜ˆì‹œ:</h4>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                ${activity.examples.map(example => 
                                    `<div style="padding: 12px; background: #f0f4f8; border-radius: 8px; border-left: 4px solid #667eea;">â€¢ ${example}</div>`
                                ).join('')}
                            </div>
                        </div>
                        <textarea id="practiceText" 
                            class="practice-input"
                            placeholder="${activity.prompt}" 
                            onkeyup="checkPracticeInput()"></textarea>
                        <div style="color: #666; font-size: 0.9em; margin-top: 10px;">
                            ğŸ’­ êµ¬ì²´ì ì´ê³  ì‹¤ì²œ ê°€ëŠ¥í•œ ë°©ë²•ì„ ì¨ë³´ì„¸ìš”!
                        </div>
                    </div>
                `;
            }
            
            // ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
            const progress = ((index + 1) / activities.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentStep').textContent = index + 1;
        }

        function updateStepIndicator(currentIndex) {
            stepNames.forEach((name, i) => {
                const step = document.getElementById(`step${i + 1}`);
                step.className = 'step';
                step.textContent = name;
                
                if (i < currentIndex) {
                    step.classList.add('completed');
                } else if (i === currentIndex) {
                    step.classList.add('active');
                }
            });
        }

        function selectChoice(choiceIndex, isCorrect, explanation) {
            const activity = activities[currentActivityIndex];
            const choices = document.querySelectorAll('.choice-btn');
            
            // ëª¨ë“  ë²„íŠ¼ ë¹„í™œì„±í™”
            choices.forEach(btn => btn.style.pointerEvents = 'none');
            
            // ì •ë‹µ í‘œì‹œ (ë„ì… ë‹¨ê³„ëŠ” ëª¨ë“  ë‹µì´ ë§ìŒ)
            if (activity.id === 'introduction') {
                choices[choiceIndex].classList.add('correct');
            } else {
                choices.forEach((btn, i) => {
                    if (activity.choices[i].correct) {
                        btn.classList.add('correct');
                    } else if (i === choiceIndex && !isCorrect) {
                        btn.classList.add('wrong');
                    }
                });
            }
            
            // ë‹µì•ˆ ê¸°ë¡
            session.addAnswer(
                activity.id, 
                activity.choices[choiceIndex].text, 
                isCorrect || activity.id === 'introduction'
            );
            
            // ì„¤ëª… í‘œì‹œ
            setTimeout(() => {
                showAlert(explanation, 'success');
                
                if (currentActivityIndex < activities.length - 1) {
                    document.getElementById('nextBtn').style.display = 'inline-block';
                } else {
                    document.getElementById('finishBtn').style.display = 'inline-block';
                }
            }, 1000);
        }

        function checkPracticeInput() {
            const textarea = document.getElementById('practiceText');
            if (textarea.value.trim().length > 15) {
                // ì‹¤ì²œ ê³„íšì„ ì¶©ë¶„íˆ ì‘ì„±í–ˆìœ¼ë©´ ê¸°ë¡
                userPractices.push(textarea.value.trim());
                session.addAnswer('practice_plan', textarea.value.trim(), true);
                
                document.getElementById('finishBtn').style.display = 'inline-block';
            }
        }

        function nextActivity() {
            currentActivityIndex++;
            document.getElementById('nextBtn').style.display = 'none';
            showActivity(currentActivityIndex);
        }

        async function finishLesson() {
            const results = await session.finish();
            
            if (results) {
                const correctRate = Math.round((results.correctAnswers / results.totalQuestions) * 100);
                let grade = '';
                let message = '';
                
                if (correctRate >= 80) {
                    grade = 'ğŸ† ìš°ìˆ˜';
                    message = 'ìš°ì• ì˜ ì°¸ëœ ì˜ë¯¸ë¥¼ ê¹Šì´ ì´í•´í–ˆì–´ìš”!';
                } else if (correctRate >= 60) {
                    grade = 'ğŸ‘ ì–‘í˜¸';
                    message = 'í˜•ì œìë§¤ ì‚¬ì´ì˜ ìš°ì• ì— ëŒ€í•´ ì˜ ìƒê°í•´ë³´ì•˜ì–´ìš”!';
                } else {
                    grade = 'ğŸ’ª ë…¸ë ¥';
                    message = 'ìš°ì• ì˜ ì†Œì¤‘í•¨ì„ ë‹¤ì‹œ í•œë²ˆ ìƒê°í•´ë³´ì„¸ìš”!';
                }
                
                let practiceDisplay = '';
                if (userPractices.length > 0) {
                    practiceDisplay = `
                        <div style="background: linear-gradient(135deg, #f0fff4 0%, #c6f6d5 100%); padding: 20px; border-radius: 15px; margin: 20px 0; text-align: left; border: 3px solid #48bb78;">
                            <h4 style="color: #2f855a; margin-bottom: 10px;">ğŸ“ ë‚˜ì˜ ìš°ì•  ì‹¤ì²œ ê³„íš:</h4>
                            <p style="font-style: italic; color: #2d3748; font-size: 1.1em; line-height: 1.6;">"${userPractices[userPractices.length - 1]}"</p>
                        </div>
                    `;
                }
                
                document.getElementById('resultContent').innerHTML = `
                    <div style="text-align: center; margin: 25px 0;">
                        <div style="font-size: 2.2em; margin-bottom: 15px;">${grade}</div>
                        <p style="font-size: 1.1em;">ì •ë‹µë¥ : <strong>${correctRate}%</strong> (${results.correctAnswers}/${results.totalQuestions})</p>
                        <p style="font-size: 1.1em;">í•™ìŠµ ì‹œê°„: <strong>${Math.round(results.duration / 60)}ë¶„ ${results.duration % 60}ì´ˆ</strong></p>
                        ${practiceDisplay}
                        <p style="color: #666; margin-top: 25px; font-size: 1.1em;">${message}</p>
                        <div style="background: linear-gradient(135deg, #ebf8ff 0%, #bee3f8 100%); padding: 20px; border-radius: 15px; margin-top: 25px; border: 3px solid #63b3ed;">
                            <h4 style="color: #2c5282; margin-bottom: 10px;">ğŸ’ ì˜¤ëŠ˜ì˜ ë°°ì›€</h4>
                            <p style="color: #2c5282; font-size: 1.1em; font-weight: 500;">
                                ìš°ì• ë€ ì„œë¡œë¥¼ ì´í•´í•˜ê³  ë°°ë ¤í•˜ë©°, í•¨ê»˜ í–‰ë³µí•´ì§€ë ¤ê³  ë…¸ë ¥í•˜ëŠ” ì•„ë¦„ë‹¤ìš´ ë§ˆìŒì…ë‹ˆë‹¤. 
                                ì—¬ëŸ¬ë¶„ì˜ ì‘ì€ ì‹¤ì²œì´ ê°€ì¡± ëª¨ë‘ë¥¼ ë”ìš± í–‰ë³µí•˜ê²Œ ë§Œë“¤ì–´ìš”! ğŸ ğŸ’•
                            </p>
                        </div>
                    </div>
                `;
                
                showModal('resultModal');
            }
        }
    </script>
</body>
</html>